# Writeup CTF - Basic Pentesting

## Informações Iniciais
- **Plataforma:** TryHackMe 
- **Dificuldade:** Fácil
- **Objetivo:** Praticar enumeração de diretórios e escalonamento de privilégios.
- **Link** https://tryhackme.com/room/basicpentestingjt
- **Ferramentas utilizadas:** 
    - **Nmap** → Varredura de portas e identificação de serviços.  
    - **Gobuster** → Descoberta de diretórios e arquivos ocultos em servidores web.  
    - **Enum4linux** → Enumeração de usuários, grupos e compartilhamentos via SMB.  
    - **Hydra** → Ataque de força bruta em serviços (SSH, FTP, RDP, etc).  
    - **SSH** → Acesso remoto ao sistema alvo.  
    - **SCP** → Transferência de arquivos entre atacante e vítima.  
    - **LinPEAS** → Enumeração de privilégios para escalada.  
    - **John the Ripper** → Quebra de senhas e chaves (ex: RSA).  
    - **ssh2john** → Conversão de chaves SSH para formato compatível com o John.

---

## Reconhecimento

### Identificação do Alvo
```
IP: 10.201.30.11
```

### Scan de Portas (Nmap)
```bash
nmap -vvv -Pn 10.201.30.11
```
- `-vvv`: saída detalhada  
- `-Pn`: ignora ping scan  

**Resultado:**  
<img width="940" height="615" alt="image" src="https://github.com/user-attachments/assets/95610c61-fc88-4f99-9129-3686a7ee6a37" />

Nesta saida conseguimos identificar os serviços rodando na máquina alvo como o SSH na porta 22, Servidor WEB Apache na porta 80, e os serviços SMB/Samba expostos nas portas 139 e 445. 


## Enumeração

Com o conhecimento de que há um servidor web rodando no alvo, realizamos a enumeração de diretórios para identificar arquivos e pastas acessíveis que poderiam revelar informações sensíveis ou vulnerabilidades exploráveis.

### Diretórios Web (Gobuster)
```bash
gobuster dir -u http://10.201.30.11 -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt -t 3 -o gobuster_output.txt
```
Explicação dos parâmetros:

**Explicação dos parâmetros utilizados:**

- `dir` → Usa o modo de busca por diretórios web.  
- `-u` → URL de destino (IP/servidor onde será feita a busca).  
- `-w` → Wordlist contendo nomes de diretórios e arquivos a testar.  
- `-t` → Número de threads simultâneas a serem usadas.  
- `-o` → Salva a saída em um arquivo de log no caminho especificado.
.

**Resultado:**  
- Diretório encontrado: `/development/`  
*Saída do Gobuster*
<img width="940" height="360" alt="image" src="https://github.com/user-attachments/assets/ac5451ec-7cdd-4154-b3e1-2eaa0526a44a" />

 - Nos arquivos encontrados, observamos uma conversa entre duas pessoas, k e j, discutindo sobre serviços configurados no servidor, como Apache e SMB, versões do REST, e a política de senhas fraca, evidenciada pelo fato de que os hashes foram facilmente quebrados.
    <img width="707" height="321" alt="image" src="https://github.com/user-attachments/assets/d0c5a454-ac08-4e5f-a88e-b819482ffaa1" />
    <img width="940" height="260" alt="image" src="https://github.com/user-attachments/assets/b1e0d0ba-f69e-4c1d-b393-369d3ea95c7f" />
    <img width="940" height="273" alt="image" src="https://github.com/user-attachments/assets/974d4ab8-4ceb-44de-a853-3fd031658be3" />


### Enumeração SMB (Enum4linux)
Após identificarmos que o serviço SMB/Samba estava ativo na máquina alvo (conforme o Nmap), utilizamos o **enum4linux** para realizar a enumeração de usuários, grupos e compartilhamentos.

```bash
enum4linux -a 10.201.30.11
```
**Parâmetros utilizados:**
 - a → realiza a enumeração completa.

**Usuários descobertos:**  
- jan  
- kay  

<img width="940" height="358" alt="image" src="https://github.com/user-attachments/assets/59e0720b-c71d-466d-9943-99e30d80d586" />


---

## Exploração

Com o nome de usuário e sabendo que a senha é fraca, vamos tentar usar o bruteforce no SSH.

### Força Bruta no SSH (Hydra)
```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.201.30.11
```
**Explicação dos parâmetros do Hydra para SSH:**

- `-l` → Usuário que já conhecemos e queremos testar.  
- `-P` → Caminho para a wordlist de senhas que será utilizada no ataque de força bruta.

<img width="940" height="306" alt="image" src="https://github.com/user-attachments/assets/d61d942b-c558-4f44-837f-824b78d3f1e8" />


**Credenciais encontradas:**  
- Usuário: `jan`  
- Senha: `armando`  
---

## Escalada de Privilégios
### Escalonamento de Privilégios com LinPEAS

Após conseguir acesso ao usuário `jan` via SSH, o próximo passo é realizar o escalonamento de privilégios para obter permissões de root. Para isso, utilizamos o **LinPEAS**, uma ferramenta de *privilege escalation* que automatiza a busca por vulnerabilidades no sistema.

#### Passos para Escalonar Privilégios:

- **Transferindo o script para a máquina de destino**  
   Vamos transferir o script LinPEAS para o diretório `/dev/shm` na máquina de destino.  
   O `/dev/shm` é uma área de memória volátil, não deixa vestígios permanentes no disco e costuma ser pouco monitorada, facilitando a transferência de arquivos sem problemas de permissões.

### Uso do LinPEAS
Transferindo e executando na máquina alvo:
```bash
scp linpeas.sh jan@10.201.30.11:/dev/shm
```
O scp é um protocolo de transferência de arquivos entre máquinas via SSH.
```bash
chmod +x linpeas.sh
```
para darmos privilegios de execução.
```bash
./linpeas.sh
```
para executarmos o script.

**Achado:**  
- Chave privada RSA do usuário `kay`.  

<img width="474" height="671" alt="image" src="https://github.com/user-attachments/assets/bafcbcd7-1003-455a-a985-1a48b7a0e02b" />


### Quebra da Chave com John
Iremos utilizar o john para quebrar a criptografia dessa chave. 
Para isso iremos copiar a chave inteira, desde o —BEGIN —, ATÉ O —END—
e colocar em um arquivo para utilizarmos o john, 
```bash
ssh2john id_rsa > pass.hash
```
com isso criamos o arquivo *id_rsa* e agora iremos utilizar o john para converter a chave para facilitar a quebra. 

damos permissão para o arquivo
```bash
chmod 600 id_rsa
```
e agora usamos o john the ripper para fazer o bruteforce no hash que temos.


```bash
john --wordlist=/usr/share/wordlists/rockyou.txt pass.hash
```

<img width="940" height="244" alt="image" src="https://github.com/user-attachments/assets/0e7d215d-bc22-4212-8e8a-c1ce7a6c12a5" />

**Senha da chave encontrada.**  
Agora que temos a senha de criptografia do usuário kay, iremos acessá-lo pelo ssh a partir do usuário jan.

Acesso ao usuário `kay`:
```bash
ssh -i /home/kay/.ssh/id_rsa kay@10.201.30.11
```
<img width="664" height="674" alt="image" src="https://github.com/user-attachments/assets/19772e94-867e-44b8-9db2-cde8a3207eae" />


e com isso temos nossa última flag do desafio.

---

## Flags
<img width="840" height="761" alt="image-10" src="https://github.com/user-attachments/assets/afe20ddd-1eee-4fde-9ff4-dd81f4dc00e1" />

---

## Lições Aprendidas

- Aprendi que **fazer enumeração primeiro** é super importante. Usar o Nmap para descobrir portas e serviços, o Gobuster para procurar diretórios escondidos e o Enum4linux para ver usuários e compartilhamentos me ajudou a entender melhor o alvo antes de atacar.  
- Vi na prática que **senhas fracas são muito perigosas**. Conseguimos acessar o usuário `jan` com certa facilidade porque a senha era simples, então sempre vale reforçar a política de senhas.  
- Descobri que **serviços expostos sem necessidade** podem entregar muitas informações. O SMB e o Apache foram úteis para conseguir dados sobre os usuários e arquivos.  
- Entender o **uso de ferramentas de pentest** como LinPEAS e John the Ripper me mostrou como automatizar a busca por vulnerabilidades e quebrar senhas de forma prática.  
- Notei que **guardar chaves privadas ou arquivos sensíveis sem cuidado** é arriscado. Encontramos a chave do `kay` facilmente, o que mostrou como isso pode comprometer o sistema.  

---
